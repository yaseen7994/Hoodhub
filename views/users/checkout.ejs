<!DOCTYPE html>
<html lang="en">


<!-- Mirrored from smartshop.websitelayout.net/home-shop-3.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 03 Jan 2023 15:59:55 GMT -->
<head>

    <!-- metas -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="HoodHub - hoodies shop" />

    <!-- title  -->
    <title>HoodHub</title>

    <!-- favicon -->
    <link rel="shortcut icon" href="/img/logos/favicon.png">
    <link rel="apple-touch-icon" href="/img/logos/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/logos/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/logos/apple-touch-icon-114x114.png">

    <!-- plugins -->
    <link rel="stylesheet" href="/css/plugins.css">

    <!-- theme core css -->
    <link href="/css/styles-2.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.all.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
    crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.all.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.3.js"
    integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
    
    <script src="https://code.jquery.com/jquery-3.6.3.js"
        integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body>

    <!-- PAGE LOADING
    ================================================== -->
    <div id="preloader"></div>

    <!-- MAIN WRAPPER
    ================================================== -->
    <div class="main-wrapper mp-pusher" id="mp-pusher">

        <!-- HEADER
        ================================================== -->
        <header class="fixed header-light-nav header-02">

            <div id="top-bar">
                <div class="container">
                    <div class="row">
                        <div class="col-3 col-md-6">
                            <div class="top-bar-info">
                                <ul class="ps-0">
                                    <li><a href="tel:01234567890"><i class="ti-mobile"></i><span class="d-none d-md-inline-block ps-2">7994515578</span></a></li>
                                    <li><a href="mailto:addyour@emailhere"><i class="ti-email"></i><span class="d-none d-md-inline-block ps-2">HoodHub12@emailhere</span></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-9 col-md-6">
                            <% if(session!=null){ %>
                                <ul class="top-nav ps-0">
                                    <li class="nav-item dropdown">
                                        <a href="#" data-bs-toggle="dropdown" class="dropdown-toggle"><i class="far fa-user"></i><span><%= user.username %></span></a>
                                        
                                        <ul class="dropdown-menu p-4">
                                            <li class="mb-2">
                                                <div class="media align-items-center">
                                                    <img class="w-40px rounded-circle me-3" src="img/avatar/01.png" alt="...">
                                                    <div class="media-body"><%= user.username %></div>
                                                </div>
    
                                            </li>
                                            <li>
                                                <a href="/profile" class="dropdown-item">My Profile</a>
                                            </li>
                                            <li>
                                                <a href="/logout" class="dropdown-item">Log Out</a>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                              
                            <%}%>
                        </div>
                            

                        </div>
                    </div>
                </div>
            </div>

            <div class="navbar-default">

               


                <div class="container">
                    <div class="row align-items-center g-0">
                        <div class="col-12 col-lg-12">
                            <div class="menu_area alt-font">
                                <nav class="navbar navbar-expand-lg navbar-light p-0">

                                    <div class="navbar-header navbar-header-custom">
                                        <!-- logo -->
                                        <a href="/" class="navbar-brand logodefault"><img id="logo" src="/img/logos/hoodhub.png" alt="logo"></a>
                                        <!-- end logo -->
                                    </div>

                                    <!-- menu toggler -->
                                    <div class="navbar-toggler"></div>
                                    <!-- end menu toggler -->

                                    <!-- menu area -->
                                    <ul class="navbar-nav mx-auto" id="nav" style="display: none;">

                                        <li><a href="/">Home</a>
                                        </li>
                                        <li><a href="/aboutus">About</a>


                                            <li><a href="/shop">Shop</a>
                                            
                                            </li>
                                        </li>

                                        <li><a href="/profile">Account</a>
                                            <ul>
                                                <% if(session!=null){ %>
                                                    <li><a href="/logout">Logout</a></li>
                                                    <li><a href="">Orders List</a></li>
                                                    <li><a href="">Wishlist</a></li>
                                                    <li><a href="">Profile Page</a></li>
                                                    <li><a href="">Shipping Address</a></li>
                                                <% }else{ %>
                                                    <li><a href="/login">Login</a></li>
                                                    <li><a href="/signup">Signup</a></li>
                                                    <% } %>
                                                
                                            </ul>
                                        </li>
                                        </li>
                                        <li><a href="/contact">Contact</a>
                                            
                                    </ul>

                                    <!-- end menu area -->

                                    <!-- attribute navigation -->
                                    <div class="attr-nav">
                                        <ul>
                                            
                                            <li class="dropdown me-3 me-lg-0">
                                                <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown">
                                                    <i class="far fa-heart"></i>
                                                    <span class="badge bg-primary">3</span>
                                                </a>
                                                <ul class="dropdown-menu cart-list">
                                                    <li>
                                                        <a href="#" class="photo"><img src="img/products/cart-thumbs/cart-thumb-01.jpg" class="cart-thumb" alt="..." /></a>
                                                        <h6><a href="#">Men's Football Boots </a></h6>
                                                        <p>2x - <span class="price">$30.00</span></p>
                                                    </li>
                                                    
                                                   
                                                </ul>
                                            </li>

                                         
                                        </ul>
                                    </div>
                                    <!-- end attribute navigation -->
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>


<div class="main-wrapper mp-pusher" id="mp-pusher">

    <!-- HEADER
================================================== -->
    
    <!-- PAGE TITLE
    ================================================== -->
    <section class="page-title-section ">
        <div class="container" >

            <div class="title-info">
                <h1>Shop Checkout</h1>
            </div>
            <div class="breadcrumbs-info">
                <ul class="ps-0">
                    <li><a href="/">Home</a></li>
                    <li><a href="">Checkout</a></li>
                </ul>
            </div>

        </div>
    </section>

    <!-- CHECKOUT
    ================================================== -->
    
    <section class="md">
        <div class="container" id="reloadDiv">
            <div class="row">
                <div class="col-lg-12 col-md-12 ps-2-3 mb-1-9 mb-lg-0">
                    <div class="common-block">

                        <div class="table-responsive">
                            <table class="table">

                                <form method="post" id="checkout_form" novalidate>

                                    <div class="table-responsive">
                                        <table class="table">
                                          <thead>
                                            <tr>
                                              <th scope="col">select</th>
                                              <th scope="col">id</th>
                                              <th scope="col">Name</th>
                                              <th scope="col">Building</th>
                                              <th scope="col">Street</th>
                                              <th scope="col">District</th>
                                              <th scope="col">State</th>
                                              <th scope="col">Pincode</th>
                                              <th scope="col">Number</th>
                                              <th scope="col">Actions</th>
                                            </tr>
                                          </thead>
                                          <tbody>
                                            <% if (user[0].address.length > 0) { %>
                                              <% user[0].address.forEach((x, index) => { %>
                                                <tr>
                                                  <td>
                                                    <div class="form-check">
                                                      <input class="form-check-input" type="radio" id="address<%= index %>" name="address[]" value="<%= index %>" <% if (index === 0) { %>checked<% } %>>
                                                      <label class="form-check-label" for="address<%= index %>"></label>
                                                    </div>
                                                  </td>
                                                  <td><%= index+1 %></td>
                                                  <td><%= x.name %></td>
                                                  <td><%= x.building %></td>
                                                  <td><%= x.street %></td>
                                                  <td><%= x.district %></td>
                                                  <td><%= x.state %></td>
                                                  <td><%= x.pincode %></td>
                                                  <td><%= x.number %></td>
                                                  <td>
                                                    <a href="/edit_address?index=<%= index %>"><i class="far fa-edit"></i></a>
                                                
                            
                                                    <a type="submit" class="ms-1" onclick="delete_address('<%= index %>')"><i style="color: rgb(170, 6, 6);" class="fa-solid fa-trash"></i></a>
                                                  </td>
                                                </tr>
                                              <% }) %>
                                            <% } else { %>
                                              <tr>
                                                <td colspan="8">
                                                  <p style="color: red;">You didn't create your Address. Click here to add a new address.</p>
                                                  <a href="/add_address" class="butn-style2 small"  ><i class="fa-solid fa-user-plus"></i>Add Address</a>
                                                </td>
                                              </tr>
                                            <% } %>
                                          </tbody>
                                        </table>
                                        <% if (0<user[0].address.length) {%>
                                            <a href="/add_address" class="butn-style2 small mt-3 mb-5" 
                                                 >Add Address </a>
                                                <% }%>
                                      </div>
                                      
                                        <input type="hidden" name="total" value="<%= user[0].cartTotel %>">


                                        <br>


                                        <div class="row">

                                        <div class="col-lg-6 col-12 side-bar">
                                            <div class="widget">
                        
                                                <div class="widget-title">
                                                    <h5>Your Cart</h5>
                                                </div>
                        
                        
                                                <table class="table classic">
                        
                                                    <tbody>
                        
                                                        <tr>
                        
                                                            <th class="text-start text-uppercase font-weight-50"><span>Products</span> </th>
                                                            <th class="text-start text-uppercase ">quantity</th>
                                                            <th class="text-start text-uppercase">Total</th>
                        
                                                        </tr>
                                                        <% user[0].cart.forEach((x)=>{ %>
                                                            <tr>
                        
                                                                <td class="text-start">
                                                                    <a href="#">
                                                                        <%= x.product.productname %>
                                                                    </a>
                                                                </td>
                                                                <td class="product-subtotal text-start"><%= x.qty %>
                                                                </td>
                                                                <td class="product-subtotal text-start">₹<%= x.price %>
                                                                </td>
                                                                
                                                            </tr>
                        
                        
                                                   
                        
                                                            <input type="hidden" name="qty" value="<%= x.qty %>">
                                                            <input type="text" name="productId" value="<%= x.product._id %>" hidden>
                                                            <input type="hidden" name="singleTotel" value="<%= x.price %>">
                                                            <input type="hidden" name="price" value="<%= x.product.price %>">
                        
                        
                                                            <% }) %>
                        
                                                    </tbody>
                                                </table>
                        
                                            </div>
                                           
                                           
                                            <div class="widget">
                                                <div class="widget-title">
                                                    <h5>Order Summary</h5>
                                                </div>
                                                <table class="table classic">
                                                    <tbody>
                                                        <tr>
                                                            <th>Cart Subtotal:</th>
                                                            <td class="text-gray-dark">₹ <%= user[0].cartTotel %>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th>Shipping:</th>
                                                            <td class="text-gray-dark">Free</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Total:</th>
                                                            <td class="text-lg text-gray-dark">₹ <%= user[0].cartTotel %>
                                                            </td>
                                                            <input type="hidden" name="totel" value="<%= user[0].cartTotel %>">
                                                        </tr>
                                                        <tr>
                                                            <th id="discountt"></th>
                                                            <td class="text-gray-dark" id="discount"></td>
                                                        </tr>
                                                        <tr>
                                                            <th id="newtotal"></th>
                                                            <td class="text-gray-dark" id="newwtotal"></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                        
                                            </div>
                                        </div>
                        
                                          
                                   
                                             
                                        <div class="col-lg-6 col-md-12 ps-2-3 mb-1-9 mb-lg-0">
                                            <div class="row">
                                        <div class="col-lg-12 mt-0">
                                            <label class="col-sm-5 col-form-label"
                                            for="basic-default-company"><strong>Payment</strong></label>
                                        <div class="feedback">How would you like to pay?</div>
                                        <br>
                                        <ul style="padding-left: 4px;">

                                            <input class="form-check-input" type="radio" value="COD"
                                                name="payment_method" required><span><strong><i style="margin-left: 5px;" class="fa-solid fa-money-check-dollar"></i> COD </strong> </span><br>

                                                <input class="form-check-input" type="radio" value="UPI"
                                                name="payment_method"  required><span><strong><i style="margin-left: 5px;" class="fa-brands fa-paypal"></i>
                                                    Razorpay </strong> </span><br>

                                            <input class="form-check-input" type="radio" value="WALLET"
                                                name="payment_method" required><span><strong>
                                                    <i class="fa-solid fa-wallet"></i> WALLET</strong> </span><br>

                                        </ul>

                                         <div class="buttons-set mt-2">
                                         <button type="submit" class="butn-style2 small" > Place Order
                                </button>
                          
                                </div>
                                </div>
                            </form>
                            <div class="col-lg-12 col-md-12 mt-5 ">
                                <div id="accordion" class="accordion-style2">
                                    <div class="card">
                                        <div class="card-header" id="headingOne">
                                            <h5 class="mb-0">
                                                <button class="btn btn-link" data-bs-toggle="collapse"
                                                    data-bs-target="#collapseOne" aria-expanded="true"
                                                    aria-controls="collapseOne">
                                                    Coupon Code
                                                </button>
                                            </h5>
                                        </div>
                                        <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-bs-parent="#accordion">
                                            <div class="card-body">
                                                <form id="apply_coupon">
                                                    <div class="row">
                                                        <div class="col-sm-12 mb-2">
                                                            <div class="form-group">
                                                                <label>Enter Your Coupon Code</label>
                                                                <input type="text" class="form-control" name="couponcode" placeholder="Enter Your Coupon Code">
                                                            </div>
                                                            <input type="hidden" name="cartTotel" value="<%= user[0].cartTotel %>">
                                                        </div>
                                                    </div>
                                                    <button type="submit" class="butn-style2 dark small">Apply Code</button>
                                                </form>
                                            </div>
                                        </div>
                                       
                                    </div>
                                </div>
                                </div>
                                

  
  
                            </table>
                        </div>
                        
                        
                    </div>
                </div>
                </div> 
    </section>


    
</div>




<a href="#" class="scroll-to-top"><i class="fas fa-angle-up" aria-hidden="true"></i></a>


 <script>

   

        $(document).ready(function () {
            $('#apply_coupon').submit(function (event) {
                event.preventDefault(); //prevent default form submit action
                var formData = $(this).serialize(); //serialize form data
                $.ajax({
                    type: 'POST',
                    url: '/apply_coupon',
                    data: formData,
                    success: function (response) {
                        if (response.success) {
                            $('#reloadDiv').load('/checkout #reloadDiv')
                            document.getElementById('discountt').innerHTML = 'discount amount : '
                            document.getElementById('discount').innerHTML = "₹" + response.discount_value
                            document.getElementById('newtotal').innerHTML = 'new total'
                            document.getElementById('newwtotal').innerHTML = "₹" + response.value
                            Swal.fire({
                                title: 'Coupon Applied SuccessFully!',
                                text: `You saved your ${response.discount_value}. Your new totel is ${response.value} `,
                                icon: 'success',
                                timer: 1500
                            })
                        } else if (response.used) {
                            Swal.fire({
                                title: 'Coupon Already Used!',
                                text: `You Already Used this coupon `,
                                icon: 'error',
                                timer: 1500
                            })
                        } else if (response.lessamount) {
                            Swal.fire({
                                title: 'Coupon Not Applicable!',
                                text: `The order totel is not sufficent to use this coupon`,
                                icon: 'error',
                                timer: 1500
                            })
                        } else if (response.expired) {
                            Swal.fire({
                                title: 'Coupon Expired!',
                                text: `The Coupon has Expired`,
                                icon: 'error',
                                timer: 1500
                            })
                        } else if (response.invalid) {
                            Swal.fire({
                                title: 'Invalid Coupon!',
                                text: `The Coupon code you enterd is invalid`,
                                icon: 'error',
                                timer: 1500
                            })
                        }
                    },
                    error: function (xhr, status, error) {
                        //handle error response
                    }
                });
            });
        });

    </script>

    <script>
        $('#checkout_form').submit((x) => {
            x.preventDefault()
            $.ajax({
                url: "/place_order",
                method: "post",
                data: $('#checkout_form').serialize(),
                success: (response) => {
                    console.log(response);
                    if (response.status) { 
                        location.href = "/order_success"
                    } else if (response.viewRazorpay) {
                        razorpayPayment(response.order)
                    } else if (response.wallet == false) {
                        Swal.fire({
                            position: 'center',
                            icon: 'error',
                            title: 'wallet has insufficient balance !',
                            showConfirmButton: false,
                            timer: 1500
                        })
                        
                    }

                }
            })
        })

        function walletPayment() {

        }

        function razorpayPayment(order) { 
            var options = {
                "key": "rzp_test_CSFlQOxXs1bvii", // Enter the Key ID generated from the Dashboard
                "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                "currency": "INR",
                "name": "HoodHub", //your business name
                "description": "Test Transaction",
                "image": "/img/logos/hoodhub.png",
                "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                "handler": function (response) {
                    // alert(response.razorpay_payment_id);
                    // alert(response.razorpay_order_id);
                    // alert(response.razorpay_signature)
                    console.log(+'dfdsfs');
                    verifyPayment(response, order)
                },
                "prefill": {
                    "name": "Yaseen ap", //your customer's name
                    "email": "yaseenap148@gmail.com",
                    "contact": "7994515578"
                },
                "notes": {
                    "address": "Razorpay Corporate Office"
                },
                "theme": {
                    "color": "#3399cc"
                },
                "modal": {
                    escape: false,
                    onDismiss: () => {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Payment failed.',
                        })

                    }
                }
            };
            var rzp1 = new Razorpay(options);
            rzp1.open();
        }
        function verifyPayment(payment, order) {
            console.log('from verifyPayment');
            $.ajax({
                url: '/verify-payment',
                data: {
                    payment,
                    order
                }, method: 'post',
                success: (response) => {

                    if (response.status) {
                        Swal.fire({
                            position: 'center',
                            icon: 'error',
                            title: 'payment failed',
                            showConfirmButton: false,
                            timer: 5000
                        })
                    } else {
                       
                        location.href = "/order_success"
                    }
                }
            })
        }

        

        </script>

<script>

    function delete_address(index) {

      Swal.fire({
        title: 'Are you sure?',
        text: "You wan't to delete this address!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'yes, delete!'
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            url: "/delete_Address",
            data: {
              indexcn: index
            },
            method: 'post',
            success: (response) => {
              $('#reloadDiv').load('/checkout #reloadDiv')
              console.log(response);
              Swal.fire({
                title: 'deleted!',
                text: 'Your deleted',
                icon: 'success',
                showConfirmButton: false,
                timer:1300,
              })

            }

          })
        }
      })
    }


  </script>

<script>

$(document).ready(function() {
  $('#remove_coupon').submit(function(e) {
    e.preventDefault();
    var couponcode = $('input[name="couponcode"]').val();
    var cartTotel = $('input[name="cartTotel"]').val();
    $.ajax({
      type: 'POST',
      url: '/remove_coupon',
      data: {
        couponcode: couponcode,
        cartTotel: cartTotel
      },
      success: function(data) {
        if (data.success) {
          window.location.reload();
        } else if (data.notfound) {
          alert('Coupon not found or already removed');
        } else {
          alert('Error removing coupon, please try again');
        }
      },
      error: function() {
        alert('Error removing coupon, please try again');
      }
    });
  });
});
</script>




<%- include('../layouts/userFooter.ejs')  %>